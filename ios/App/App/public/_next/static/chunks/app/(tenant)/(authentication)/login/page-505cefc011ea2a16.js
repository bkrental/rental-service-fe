(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{26463:function(e,n,t){Promise.resolve().then(t.bind(t,15553))},15553:function(e,n,t){"use strict";t.r(n);var r=t(3827),a=t(8792),s=t(37732),o=t(32726),u=t(31963),i=t(17540);t(51420);var c=t(75504),l=t(3537),d=t(30828),h=t(28044);n.default=function(){let e=(0,d.I0)(),[n]=(0,u.YA)(),t=(0,o.Z)(),m=async(r,a)=>{let{setSubmitting:s,setFieldError:o}=a;try{let a=await n(r).unwrap();s(!1),e((0,i.he)(a.data)),t()}catch(e){console.log(e),o("password",e.data.message)}};return(0,r.jsxs)("div",{className:"auth_form-container",children:[(0,r.jsx)(l.J9,{initialValues:{phone:"",password:""},validationSchema:h.d,validateOnChange:!1,validateOnBlur:!1,onSubmit:m,children:e=>{let{isSubmitting:n,errors:t}=e;return(0,r.jsxs)(l.l0,{className:"auth_form",children:[(0,r.jsx)(l.gN,{className:(0,c.Z)("auth_form-input",t.phone&&"auth_form-input--error"),type:"phone",name:"phone",placeholder:"Phone Number*"}),(0,r.jsx)(l.Bc,{className:"auth_form-message auth_form-message--error",name:"phone",component:"p"}),(0,r.jsx)(l.gN,{className:(0,c.Z)("auth_form-input",t.password&&"auth_form-input--error"),type:"password",name:"password",placeholder:"Password*"}),(0,r.jsx)(l.Bc,{className:"auth_form-message auth_form-message--error",name:"password",component:"p"}),(0,r.jsx)(s.Z,{loading:n,children:"Login"})]})}}),(0,r.jsx)(a.default,{href:"/signup",children:(0,r.jsx)("button",{className:"btn btn-default-success btn-xl",children:"Create new account"})})]})}},37732:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(3827),a=t(75504),s=t(56181);function o(e){let{loading:n,children:t,...o}=e;return(0,r.jsx)("button",{className:(0,a.Z)("auth_submit-btn",n&&"auth_submit-btn--loading"),type:"submit",children:n?(0,r.jsx)(s.Z,{loading:n,color:"#000",size:20}):t})}},32726:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(47907);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",n=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("returnURL");return()=>{n.push(t||e)}}},14342:function(e,n,t){"use strict";t.d(n,{g:function(){return i}});var r=t(27230),a=t(43741),s=t(17540);let o=(0,r.ni)({baseUrl:"http://localhost:3000",prepareHeaders:(e,n)=>{let{getState:t}=n,r=t().auth.accessToken;return r&&e.set("Authorization","Bearer ".concat(r)),e}}),u=async(e,n,t)=>{var r;let a=await o(e,n,t);if((null==a?void 0:null===(r=a.error)||void 0===r?void 0:r.originalStatus)===401){console.log("sending refresh token");let r=await o("/auth/refresh",n,t);console.log("refreshResult",r),(null==r?void 0:r.data)?(n.dispatch((0,s.ps)({...auth,accessToken:r.data.accessToken})),a=await o(e,n,t)):(console.log("refresh failed"),n.dispatch((0,s.TT)()))}return a},i=(0,a.LC)({baseQuery:u,endpoints:e=>({})})},31963:function(e,n,t){"use strict";t.d(n,{Bl:function(){return a},YA:function(){return r}});let{useLoginMutation:r,useSignupMutation:a}=t(14342).g.injectEndpoints({endpoints:e=>({login:e.mutation({query:e=>({url:"/auth/login",method:"POST",body:{...e}})}),signup:e.mutation({query:e=>({url:"/auth/signup",method:"POST",body:{...e}})})})})},17540:function(e,n,t){"use strict";t.d(n,{TT:function(){return s},he:function(){return o},ps:function(){return a}});let r=(0,t(46608).oM)({name:"auth",initialState:{accessToken:null,user:null,isAuthenticated:!1},reducers:{loginSuccess:(e,n)=>{e.accessToken=n.payload.access_token,e.user=n.payload.user,e.isAuthenticated=!0},setUserInfo:(e,n)=>{e.accessToken=n.payload.access_token,e.user=n.payload.user,e.isAuthenticated=!0},removeUserInfo:(e,n)=>{localStorage.removeItem("accessToken"),e.isAuthenticated=!1,e.user=null,e.accessToken=null}}}),{setUserInfo:a,removeUserInfo:s,loginSuccess:o}=r.actions;n.ZP=r.reducer},28044:function(e,n,t){"use strict";t.d(n,{J:function(){return s},d:function(){return a}});var r=t(41991);let a=(0,r.Ry)({phone:(0,r.Z_)().required("Please enter your phone number"),password:(0,r.Z_)().required("Please enter your password")}),s=(0,r.Ry)({name:(0,r.Z_)().required("Please enter your name"),phone:(0,r.Z_)().matches(/(\+84|84|0[3|5|7|8|9])+([0-9]{8})\b/g,"Phone number must be a Vietnamese phone number.\n Ex: 0828696919 or +84828696919").required("Please enter your phone number"),email:(0,r.Z_)().email("Invalid email format").required("Please enter your email"),password:(0,r.Z_)().min(8,"Password must have at least 8 characters").required("Please enter your password")})},51420:function(){}},function(e){e.O(0,[665,792,741,807,971,69,744],function(){return e(e.s=26463)}),_N_E=e.O()}]);